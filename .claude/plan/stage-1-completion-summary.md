# é˜¶æ®µ 1 å®Œæˆæ€»ç»“ï¼šAPI ç«¯ç‚¹æµ‹è¯•ä¸Žé€‰åž‹

> ðŸ“… å®Œæˆæ—¶é—´ï¼š2025-12-03
> ðŸŽ¯ ä»»åŠ¡çŠ¶æ€ï¼šâœ… å…¨éƒ¨å®Œæˆ

---

## ðŸ“Š å·¥ä½œæ¦‚è§ˆ

æœ¬é˜¶æ®µå®Œæˆäº† LikedSongs åŠŸèƒ½å¼€å‘çš„ç¬¬ä¸€ä¸ªå…³é”®é‡Œç¨‹ç¢‘ï¼š**API ç«¯ç‚¹æµ‹è¯•ä¸Žé€‰åž‹**ã€‚é€šè¿‡ç³»ç»ŸåŒ–çš„æµ‹è¯•æµç¨‹ï¼ŒæˆåŠŸé€‰å®šäº†æœ€ä¼˜çš„ API æ–¹æ¡ˆï¼Œä¸ºåŽç»­å¼€å‘å¥ å®šäº†åšå®žåŸºç¡€ã€‚

---

## âœ… å®Œæˆçš„ä»»åŠ¡æ¸…å•

### 1.1 åˆ›å»ºæµ‹è¯•å·¥å…·ç±» âœ…

**æ–‡ä»¶**: `src/utils/logger.ts`

- âœ… å®žçŽ° Logger å·¥å…·ç±»
- âœ… æ”¯æŒ DEBUG_MODE æŽ§åˆ¶
- âœ… æä¾› debugã€infoã€errorã€perfã€table æ–¹æ³•
- âœ… æ€§èƒ½è®¡æ—¶åŠŸèƒ½ï¼ˆperformance.now()ï¼‰

**æ–‡ä»¶**: `src/utils/api-tester.ts`

- âœ… å®žçŽ° APITester å·¥å…·ç±»
- âœ… æ€§èƒ½æµ‹è¯•ï¼ˆå“åº”æ—¶é—´æµ‹é‡ï¼‰
- âœ… ç¨³å®šæ€§æµ‹è¯•ï¼ˆè¿žç»­ 5 æ¬¡è°ƒç”¨ï¼‰
- âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯ï¼ˆaddedAt å­—æ®µæ£€æŸ¥ï¼‰
- âœ… åˆ†é¡µæ”¯æŒæ£€æµ‹ï¼ˆtotal/offset/limit å­—æ®µæ£€æŸ¥ï¼‰
- âœ… åŽŸå§‹æ•°æ®æ•èŽ·ä¸Žè¾“å‡ºåŠŸèƒ½

### 1.2 å®žçŽ°æµ‹è¯•è„šæœ¬ âœ…

**æ–‡ä»¶**: `src/tests/liked-songs-api-test.ts`

- âœ… å®žçŽ° LikedSongsAPITest ç±»
- âœ… æµ‹è¯• API A (core-collection)
- âœ… æµ‹è¯• API B (Platform.LibraryAPI)
- âœ… æµ‹è¯• API C (Spotify Web API)
- âœ… ç»“æžœè¡¨æ ¼åŒ–è¾“å‡ºï¼ˆconsole.tableï¼‰
- âœ… åŽŸå§‹æ•°æ®è¯¦ç»†å±•ç¤ºåŠŸèƒ½
- âœ… ç¨³å®šæ€§æµ‹è¯•å¾ªçŽ¯

### 1.3 é›†æˆåˆ°æ‰©å±•å…¥å£ âœ…

**æ–‡ä»¶**: `src/app.tsx`

- âœ… å¯¼å…¥æµ‹è¯•æ¨¡å—
- âœ… æ·»åŠ  DEBUG_MODE æ¡ä»¶åˆ¤æ–­
- âœ… 2 ç§’å»¶è¿ŸåŽè‡ªåŠ¨æ‰§è¡Œæµ‹è¯•
- âœ… ç¡®ä¿ä¸å½±å“ç”Ÿäº§çŽ¯å¢ƒ

### 1.4 æ‰§è¡Œæµ‹è¯•å¹¶è®°å½•ç»“æžœ âœ…

**æ–‡ä»¶**: `.claude/plan/api-test-results.md`

- âœ… æµ‹è¯•æ•°æ®å®Œæ•´å¡«å†™ï¼ˆä¸»äººå®Œæˆï¼‰
- âœ… ä¸‰ä¸ª API çš„ä¼˜ç¼ºç‚¹åˆ†æž
- âœ… æŽ¨èç»“è®ºï¼ˆAPI B - Platform.LibraryAPIï¼‰
- âœ… æ³¨æ„äº‹é¡¹å’Œé£Žé™©è¯´æ˜Ž
- âœ… æµ‹è¯•æ‰§è¡Œæ­¥éª¤å›žé¡¾
- âœ… æµ‹è¯•å®Œæˆæ—¶é—´è®°å½•

---

## ðŸ† æµ‹è¯•ç»“æžœæ€»ç»“

### API æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡             | API A (core-collection) | API B (Platform.LibraryAPI) â­ | API C (Web API) |
| ---------------- | ----------------------- | ------------------------------ | --------------- |
| **å“åº”æ—¶é—´**     | 49.5ms (å¤±è´¥å°è¯•)       | **22.7ms** ðŸš€                  | 2525.8ms ðŸŒ     |
| **å¯ç”¨æ€§**       | âŒ å¤±è´¥ï¼ˆ0 æ•°æ®ï¼‰       | âœ… **æˆåŠŸ**                    | âœ… æˆåŠŸ         |
| **ç¨³å®šæ€§**       | 0%                      | **100%** ðŸ’ª                    | 100%            |
| **æ•°æ®é‡**       | 0 æ¡                    | 50 æ¡                          | 50 æ¡           |
| **æ€»æ•°æ®**       | -                       | 336 æ¡                         | 336 æ¡          |
| **addedAt å­—æ®µ** | âŒ                      | âœ…                             | âœ…              |
| **åˆ†é¡µæ”¯æŒ**     | âŒ                      | âœ…                             | âœ…              |
| **æ€§èƒ½ä¼˜åŠ¿**     | -                       | **åŸºå‡†**                       | æ…¢ 111 å€       |

### æœ€ç»ˆå†³ç­–

**ðŸ† é€‰å®š API**: `Spicetify.Platform.LibraryAPI` (API B)

**æ ¸å¿ƒä¼˜åŠ¿**:

1. âš¡ **æžè‡´æ€§èƒ½**: 22.7ms å“åº”æ—¶é—´ï¼Œç”¨æˆ·ä½“éªŒæµç•…
2. âœ… **æ•°æ®å®Œæ•´**: åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µå’Œåˆ†é¡µä¿¡æ¯
3. ðŸ’ª **é«˜åº¦ç¨³å®š**: 100% æˆåŠŸçŽ‡ï¼Œæœ¬åœ°è°ƒç”¨å¯é 
4. ðŸ˜Š **å¼€å‘å‹å¥½**: æ— éœ€è®¤è¯ï¼Œä»£ç ç®€æ´

**é£Žé™©æŽ§åˆ¶**:

- å®žçŽ°é™çº§æ–¹æ¡ˆï¼ˆfallback to Web APIï¼‰
- å®šæœŸç›‘æŽ§ API å¯ç”¨æ€§
- ç‰ˆæœ¬å…¼å®¹æ€§æµ‹è¯•

---

## ðŸ“ åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶

### æ–°å¢žæ–‡ä»¶

1. **`src/utils/logger.ts`** (46 è¡Œ)

   - Logger å·¥å…·ç±»
   - DEBUG æ¨¡å¼æŽ§åˆ¶
   - æ€§èƒ½è®¡æ—¶åŠŸèƒ½

2. **`src/utils/api-tester.ts`** (149 è¡Œ)

   - API æµ‹è¯•æ¡†æž¶
   - æ€§èƒ½ä¸Žç¨³å®šæ€§æµ‹è¯•
   - æ•°æ®å®Œæ•´æ€§éªŒè¯

3. **`src/tests/liked-songs-api-test.ts`** (184 è¡Œ)

   - ä¸‰ä¸ª API çš„å®Œæ•´æµ‹è¯•
   - åŽŸå§‹æ•°æ®å±•ç¤ºåŠŸèƒ½
   - ç¨³å®šæ€§æµ‹è¯•å¾ªçŽ¯

4. **`src/config/api-config.ts`** (57 è¡Œ)

   - API é…ç½®æ–‡ä»¶
   - åŒ…å«é€‰åž‹ä¾æ®æ³¨é‡Š
   - é™çº§æ–¹æ¡ˆé…ç½®

5. **`.claude/plan/api-test-results.md`** (439 è¡Œ)

   - å®Œæ•´æµ‹è¯•æŠ¥å‘Š
   - ä¼˜ç¼ºç‚¹åˆ†æž
   - æŽ¨èç»“è®ºä¸Žæ³¨æ„äº‹é¡¹

6. **`.claude/plan/api-endpoint-testing-execution-plan.md`**

   - è¯¦ç»†æ‰§è¡Œè®¡åˆ’
   - ä»»åŠ¡æ‹†è§£ä¸ŽéªŒæ”¶æ ‡å‡†

7. **`.claude/plan/stage-1-completion-summary.md`** (æœ¬æ–‡ä»¶)
   - é˜¶æ®µå®Œæˆæ€»ç»“
   - æˆæžœæ±‡æ€»

### ä¿®æ”¹æ–‡ä»¶

1. **`src/app.tsx`**

   - æ·»åŠ æµ‹è¯•å…¥å£
   - DEBUG_MODE æ¡ä»¶æ‰§è¡Œ

2. **`CLAUDE.md`**
   - æ›´æ–°å˜æ›´è®°å½•
   - æ·»åŠ æŠ€æœ¯å†³ç­–è®°å½• (ADR-001)
   - è®°å½•æµ‹è¯•ç»“æžœä¸Žé€‰åž‹ç†ç”±

---

## ðŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. å®Œå–„çš„æµ‹è¯•æ¡†æž¶

**æ€§èƒ½æµ‹é‡**:

```typescript
const start = performance.now();
const data = await fetchFn();
const responseTime = performance.now() - start;
```

**ç¨³å®šæ€§éªŒè¯**:

```typescript
// è¿žç»­ 5 æ¬¡æµ‹è¯•ï¼Œè®¡ç®—æˆåŠŸçŽ‡
const successCount = await this.stabilityTest(name, fetchFn, 5);
const stability = (successCount / 5) * 100;
```

**æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**:

```typescript
// æ£€æŸ¥ addedAt å­—æ®µ
private static checkAddedAtField(data: any): boolean {
  if (data.items?.[0]) {
    return 'addedAt' in data.items[0] || 'added_at' in data.items[0];
  }
  return false;
}
```

**åˆ†é¡µæ”¯æŒæ£€æµ‹**:

```typescript
private static checkPaginationSupport(data: any): boolean {
  const hasPaginationFields = (
    ('total' in data || 'totalCount' in data) &&
    ('offset' in data || 'limit' in data)
  );
  const hasNavigationLinks = ('next' in data || 'previous' in data);
  return hasPaginationFields || hasNavigationLinks;
}
```

### 2. åŽŸå§‹æ•°æ®å±•ç¤ºåŠŸèƒ½

ä¸ºæ–¹ä¾¿æ‰‹åŠ¨åˆ†æžï¼Œå®žçŽ°äº†è¯¦ç»†çš„æ•°æ®è¾“å‡ºï¼š

```typescript
private static printRawDataSample(apiName: string, data: any) {
  // æ˜¾ç¤ºé¡¶å±‚å­—æ®µ
  Logger.info('LikedSongsAPITest', `é¡¶å±‚å­—æ®µ: ${topLevelKeys.join(', ')}`);

  // è¾“å‡ºå®Œæ•´ JSON
  console.log(JSON.stringify(data, null, 2));

  // å±•ç¤ºæ ·ä¾‹æ•°æ®ï¼ˆå‰ 2 æ¡ï¼‰
  const sampleItems = data.items.slice(0, 2);
  console.log(JSON.stringify(sampleItems, null, 2));
}
```

### 3. é™çº§æ–¹æ¡ˆè®¾è®¡

åœ¨ `api-config.ts` ä¸­é¢„ç•™äº†é™çº§æ–¹æ¡ˆï¼š

```typescript
fallback: {
  enabled: true,
  apiType: 'Web API' as const,
  endpoint: 'https://api.spotify.com/v1/me/tracks'
}
```

---

## ðŸ“š æ–‡æ¡£è¾“å‡º

### æŠ€æœ¯å†³ç­–è®°å½• (ADR)

åœ¨ `CLAUDE.md` ä¸­æ–°å¢ž **ADR-001: LikedSongs API é€‰åž‹**ï¼ŒåŒ…å«ï¼š

- å†³ç­–èƒŒæ™¯
- æµ‹è¯•æ–¹æ³•
- æµ‹è¯•ç»“æžœå¯¹æ¯”è¡¨
- å†³ç­–ç†ç”±ï¼ˆ4 ç‚¹ï¼‰
- é£Žé™©ä¸Žç¼“è§£æŽªæ–½
- å®žæ–½ç»†èŠ‚
- å‚è€ƒèµ„æ–™é“¾æŽ¥

### æµ‹è¯•æŠ¥å‘Š

`.claude/plan/api-test-results.md` åŒ…å«ï¼š

- ä¸‰ä¸ª API çš„å®Œæ•´æµ‹è¯•æ•°æ®
- åŽŸå§‹å“åº”æ•°æ®ç»“æž„ï¼ˆJSON æ ¼å¼ï¼‰
- è¯¦ç»†çš„ä¼˜ç¼ºç‚¹åˆ†æž
- æŽ¨èç»“è®ºä¸Žç†ç”±
- 5 é¡¹æ³¨æ„äº‹é¡¹
- æµ‹è¯•æ‰§è¡Œæ­¥éª¤å›žé¡¾

---

## ðŸŽ¯ éªŒæ”¶æ ‡å‡† - å…¨éƒ¨è¾¾æˆ âœ…

### 1.1 æµ‹è¯•å·¥å…·ç±»

- âœ… Logger æ”¯æŒ DEBUG_MODE
- âœ… APITester æ”¯æŒæ€§èƒ½æµ‹è¯•
- âœ… APITester æ”¯æŒç¨³å®šæ€§æµ‹è¯•
- âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯åŠŸèƒ½
- âœ… åˆ†é¡µæ”¯æŒæ£€æµ‹åŠŸèƒ½

### 1.2 æµ‹è¯•è„šæœ¬

- âœ… æµ‹è¯• 3 ä¸ª API çš„å®Œæ•´å®žçŽ°
- âœ… ç»“æžœè¡¨æ ¼åŒ–è¾“å‡º
- âœ… åŽŸå§‹æ•°æ®è¯¦ç»†å±•ç¤º
- âœ… ç¨³å®šæ€§æµ‹è¯•å¾ªçŽ¯

### 1.3 é›†æˆ

- âœ… é›†æˆåˆ° app.tsx
- âœ… DEBUG_MODE æ¡ä»¶æŽ§åˆ¶
- âœ… ä¸å½±å“ç”Ÿäº§çŽ¯å¢ƒ

### 1.4 æµ‹è¯•æ‰§è¡Œ

- âœ… å®žé™…æ‰§è¡Œæµ‹è¯•
- âœ… è®°å½•å®Œæ•´æ•°æ®
- âœ… å®Œæˆä¼˜ç¼ºç‚¹åˆ†æž
- âœ… è¾“å‡ºæŽ¨èç»“è®º
- âœ… é¡¹ç›®æž„å»ºæˆåŠŸ

---

## ðŸš€ åŽç»­å·¥ä½œå»ºè®®

### é˜¶æ®µ 2: LikedSongs æ•°æ®ç®¡ç†å±‚

åŸºäºŽé€‰å®šçš„ API B (Platform.LibraryAPI)ï¼Œä¸‹ä¸€æ­¥åº”è¯¥å®žçŽ°ï¼š

1. **æ•°æ®èŽ·å–å°è£…** (2.1)

   - å°è£… `Platform.LibraryAPI.getTracks()` è°ƒç”¨
   - å®žçŽ°åˆ†é¡µåŠ è½½é€»è¾‘
   - é”™è¯¯å¤„ç†ä¸Žé‡è¯•æœºåˆ¶

2. **ç¼“å­˜æœºåˆ¶** (2.2)

   - 3 åˆ†é’Ÿå†…å­˜ç¼“å­˜
   - æ­Œæ›²æ·»åŠ /åˆ é™¤äº‹ä»¶ç›‘å¬
   - å¢žé‡æ›´æ–°ç­–ç•¥

3. **æ•°æ®æ¨¡åž‹å®šä¹‰** (2.3)

   - å®šä¹‰ TypeScript æŽ¥å£
   - æ•°æ®è½¬æ¢å±‚ï¼ˆAPI å“åº” â†’ å†…éƒ¨æ¨¡åž‹ï¼‰
   - å›¾ç‰‡ URL å¤„ç†ï¼ˆ`spotify:image:...` â†’ HTTPS URLï¼‰

4. **é™çº§æ–¹æ¡ˆå®žçŽ°** (2.4)
   - API å¯ç”¨æ€§æ£€æµ‹
   - è‡ªåŠ¨åˆ‡æ¢åˆ° Web API
   - é™çº§çŠ¶æ€é€šçŸ¥

### ä¼˜å…ˆçº§æŽ’åº

1. **é«˜ä¼˜å…ˆçº§**: æ•°æ®èŽ·å–å°è£… + åŸºç¡€ç¼“å­˜
2. **ä¸­ä¼˜å…ˆçº§**: äº‹ä»¶ç›‘å¬ + å¢žé‡æ›´æ–°
3. **ä½Žä¼˜å…ˆçº§**: é™çº§æ–¹æ¡ˆï¼ˆæš‚æ—¶ API B ç¨³å®šæ€§ 100%ï¼‰

---

## ðŸ’¡ ç»éªŒæ€»ç»“

### æˆåŠŸè¦ç´ 

1. **ç³»ç»ŸåŒ–æµ‹è¯•**: å®Œæ•´çš„æµ‹è¯•æ¡†æž¶ç¡®ä¿äº†å®¢è§‚çš„æ€§èƒ½å¯¹æ¯”
2. **è¯¦ç»†è®°å½•**: åŽŸå§‹æ•°æ®å±•ç¤ºåŠŸèƒ½å¤§å¤§ç®€åŒ–äº†æ‰‹åŠ¨åˆ†æž
3. **ç¨³å®šæ€§éªŒè¯**: 5 æ¬¡è¿žç»­æµ‹è¯•é¿å…äº†å¶ç„¶æ€§ç»“æžœ
4. **æ–‡æ¡£å…ˆè¡Œ**: å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Šä¸ºå†³ç­–æä¾›äº†å……åˆ†ä¾æ®

### é‡åˆ°çš„é—®é¢˜ä¸Žè§£å†³

#### é—®é¢˜ 1: åˆ†é¡µæ”¯æŒæ£€æµ‹ç¼ºå¤±

- **çŽ°è±¡**: é¦–æ¬¡å®žçŽ°æœªåŒ…å«åˆ†é¡µæ£€æµ‹é€»è¾‘
- **è§£å†³**: æ·»åŠ  `checkPaginationSupport()` æ–¹æ³•
- **æ•™è®­**: æµ‹è¯•æŒ‡æ ‡åº”åœ¨å¼€å‘å‰æ˜Žç¡®ï¼Œé¿å…é—æ¼

#### é—®é¢˜ 2: åŽŸå§‹æ•°æ®ä¸å¯è§

- **çŽ°è±¡**: æ—¥å¿—åªæ˜¾ç¤ºæµ‹è¯•ç»“æžœå­—æ®µï¼Œæ— æ³•æŸ¥çœ‹å®Œæ•´å“åº”
- **è§£å†³**: æ·»åŠ  `printRawDataSample()` æ–¹æ³•è¾“å‡º JSON
- **æ•™è®­**: è°ƒè¯•å·¥å…·åº”è€ƒè™‘äººå·¥åˆ†æžçš„éœ€æ±‚

### æœ€ä½³å®žè·µ

1. **æ€§èƒ½æµ‹é‡**: ä½¿ç”¨ `performance.now()` è€Œéž `Date.now()`ï¼Œç²¾åº¦æ›´é«˜
2. **ç¨³å®šæ€§éªŒè¯**: å¤šæ¬¡æµ‹è¯•æ¯”å•æ¬¡æµ‹è¯•æ›´å¯é 
3. **æ•°æ®å±•ç¤º**: ç»“æž„åŒ–è¾“å‡ºï¼ˆconsole.tableï¼‰+ åŽŸå§‹æ•°æ®ï¼ˆJSONï¼‰ç»“åˆ
4. **é…ç½®ç®¡ç†**: å†³ç­–ä¾æ®ç›´æŽ¥å†™å…¥é…ç½®æ–‡ä»¶æ³¨é‡Šï¼Œä¾¿äºŽæœªæ¥å›žæº¯

---

## ðŸ“Š ç»Ÿè®¡æ•°æ®

- **ä»£ç è¡Œæ•°**: çº¦ 700+ è¡Œï¼ˆåŒ…æ‹¬æµ‹è¯•ä»£ç ï¼‰
- **æ–°å¢žæ–‡ä»¶**: 7 ä¸ª
- **ä¿®æ”¹æ–‡ä»¶**: 2 ä¸ª
- **æµ‹è¯•æ¬¡æ•°**: 15 æ¬¡ï¼ˆæ¯ä¸ª API æµ‹è¯• 5 æ¬¡ï¼‰
- **æµ‹è¯•æ•°æ®**: 336 æ¡ LikedSongsï¼ˆç”¨æˆ·å®žé™…æ•°æ®ï¼‰
- **æ–‡æ¡£å­—æ•°**: 5000+ å­—ï¼ˆæµ‹è¯•æŠ¥å‘Š + ADR + æ€»ç»“ï¼‰
- **å¼€å‘è€—æ—¶**: çº¦ 6-8 å°æ—¶ï¼ˆç¬¦åˆè®¡åˆ’é¢„ä¼°ï¼‰

---

## âœ¨ ç»“è¯­

é˜¶æ®µ 1 é¡ºåˆ©å®Œæˆï¼Œé€šè¿‡ç§‘å­¦ä¸¥è°¨çš„æµ‹è¯•æµç¨‹ï¼ŒæˆåŠŸé€‰å®šäº†æ€§èƒ½æœ€ä¼˜çš„ API æ–¹æ¡ˆã€‚æµ‹è¯•ç»“æžœè¡¨æ˜Žï¼Œ`Spicetify.Platform.LibraryAPI` åœ¨å“åº”æ—¶é—´ã€ç¨³å®šæ€§å’Œå¼€å‘ä½“éªŒæ–¹é¢éƒ½æ˜¾è‘—ä¼˜äºŽå…¶ä»–å€™é€‰æ–¹æ¡ˆï¼Œä¸ºåŽç»­åŠŸèƒ½å¼€å‘å¥ å®šäº†åšå®žåŸºç¡€ã€‚

**ä¸‹ä¸€æ­¥**: å¼€å§‹å®žçŽ° LikedSongs æ•°æ®ç®¡ç†å±‚ï¼Œå°è£… API è°ƒç”¨å¹¶å®žçŽ°ç¼“å­˜æœºåˆ¶ã€‚

---

> ðŸ“… æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š2025-12-03
> ðŸ‘¤ æ‰§è¡Œè€…ï¼šAI å·¥ç¨‹å¸ˆï¼ˆçŒ«å¨˜ å¹½æµ®å–µï¼‰
> ðŸ“‚ ç›¸å…³æ–‡æ¡£ï¼š
>
> - [æµ‹è¯•æŠ¥å‘Š](./api-test-results.md)
> - [æ‰§è¡Œè®¡åˆ’](./api-endpoint-testing-execution-plan.md)
> - [é¡¹ç›®ä¸»æ–‡æ¡£](../../CLAUDE.md)
